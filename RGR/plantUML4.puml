@startuml MultiWindowSequence

!theme plain
skinparam sequenceMessageAlign center
skinparam BoxPadding 10
skinparam ParticipantPadding 20

title Sequence Diagram: –ú–Ω–æ–≥–æ–æ–∫–æ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (20 –±–∞–ª–ª–æ–≤)

actor "üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" as user
participant "üñ•Ô∏è PowerSystemDemo" as main <<Main Window>>
participant "üìã DeviceSelectionDialog" as dialog <<Modal>>
participant "‚òï KettleWindow #1" as window1 <<Device Window>>
participant "‚òï KettleWindow #2" as window2 <<Device Window>>
participant "‚öôÔ∏è PowerSystemController" as controller <<Singleton>>

autonumber

== üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ==
user -> main: –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
activate main #LightBlue
main -> controller: new PowerSystemController()
activate controller #LightGreen
main -> main: setupMenuBar()
return
deactivate controller

== ‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ ==
user -> main: –î–æ–±–∞–≤–∏—Ç—å —á–∞–π–Ω–∏–∫ #1
main -> controller: addDevice(kettleController1)
activate controller #LightGreen
controller -> controller: start()
return
deactivate controller

user -> main: –î–æ–±–∞–≤–∏—Ç—å —á–∞–π–Ω–∏–∫ #2
main -> controller: addDevice(kettleController2)

== ü™ü –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–µ—Ä–≤–æ–≥–æ –æ–∫–Ω–∞ ==
user -> main: –ú–µ–Ω—é ‚Üí –û–∫–Ω–∞ ‚Üí –ß–∞–π–Ω–∏–∫...
main -> dialog: new DeviceSelectionDialog(kettles)
activate dialog #LightYellow
dialog -> user: üìã –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
user -> dialog: ‚úÖ –í—ã–±–æ—Ä "–ß–∞–π–Ω–∏–∫ #1"
return kettleController1
deactivate dialog

main -> window1: **new** KettleWindow(controller1, powerSystem)
activate window1 #LightCoral
window1 -> window1: windowCounter++ ‚Üí "–û–∫–Ω–æ #1"
window1 -> window1: initComponents()
window1 -> window1: startUpdates()
window1 -> user: ‚ú® –ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ
deactivate main

== ü™ü –û—Ç–∫—Ä—ã—Ç–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –æ–∫–Ω–∞ (–¢–û–¢ –ñ–ï –ß–ê–ô–ù–ò–ö!) ==
user -> main: –ú–µ–Ω—é ‚Üí –û–∫–Ω–∞ ‚Üí –ß–∞–π–Ω–∏–∫...
activate main #LightBlue
main -> dialog: new DeviceSelectionDialog(kettles)
activate dialog #LightYellow
user -> dialog: ‚úÖ –í—ã–±–æ—Ä "–ß–∞–π–Ω–∏–∫ #1" (–ø–æ–≤—Ç–æ—Ä–Ω–æ!)
return kettleController1
deactivate dialog

main -> window2: **new** KettleWindow(controller1, powerSystem)
activate window2 #LightSalmon
window2 -> window2: windowCounter++ ‚Üí "–û–∫–Ω–æ #2"
note right of window2 #FFAAAA
  ‚ö†Ô∏è **–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã**
  –î–í–ê –æ–∫–Ω–∞ –¥–ª—è –û–î–ù–û–ì–û —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞!
end note
window2 -> window2: startUpdates()
window2 -> user: ‚ú® –ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ
deactivate main

== üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Observer ==
user -> window1: üîå –ö–ª–∏–∫ "–í–∫–ª—é—á–∏—Ç—å"
window1 -> controller: kettle.turnOn()
activate controller #LightGreen
controller -> controller: notifyListeners()
controller --> window1: onStateChanged(event)
controller --> window2: onStateChanged(event)
activate window2 #LightSalmon
window2 -> window2: updateData()
note right of window2 #AAFFAA
  ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**
  –û–∫–Ω–æ #2 —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
  —á–µ—Ä–µ–∑ Observer pattern
end note
deactivate window2
deactivate controller

== ‚ùå –ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞ ==
user -> window2: –ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ #2
activate window2 #LightSalmon
window2 -> window2: stopUpdates()
window2 -> window2: dispose()
destroy window2

note over window1 #AAFFFF
  ‚úÖ –û–∫–Ω–æ #1 —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
  –°–ª–µ–¥—É—é—â–µ–µ –±—É–¥–µ—Ç "–û–∫–Ω–æ #3"
end note

deactivate window1

footer "–†–ì–† –ß–∞—Å—Ç—å 4 –∏–∑ 5 Sequence Diagram: –ú–Ω–æ–≥–æ–æ–∫–æ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å"

@enduml